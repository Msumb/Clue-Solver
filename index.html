<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RS3 Elite Clue Solver (Alt1)</title>
  <script>
  const CONFIG_URL = "https://msumb.github.io/Clue-Solver/appconfig.json";
  const a1state = document.getElementById("a1state");

  // Keep checking every 400ms until Alt1 injects window.alt1
  let tries = 0;
  const t = setInterval(() => {
    tries++;
    if (window.alt1 && alt1.versionint) {
      a1state.textContent = `Alt1 detected v${alt1.version}`;
      // Show the add-app dialog as soon as Alt1 is ready
      try { alt1.identifyAppUrl(CONFIG_URL); } catch (e) { console.log(e); }
      clearInterval(t);
    } else {
      // Show a helpful status while we wait
      a1state.textContent = "Waiting for Alt1… (open this in Alt1 → Browser)";
      if (tries > 30) { // ~12s timeout
        a1state.textContent = "Not running inside Alt1";
        clearInterval(t);
      }
    }
  }, 400);

  // Button fallback: encoded alt1:// link for external browsers, direct identify when in Alt1
  document.getElementById("btnInstall").onclick = () => {
    if (window.alt1 && alt1.versionint) {
      try {
        const cfg = {
          name: "RS3 Elite Compass Solver",
          description: "Auto compass triangulation with overlay + pins.",
          version: "1.0.0",
          appUrl: "https://msumb.github.io/Clue-Solver/index.html",
          configUrl: CONFIG_URL,
          iconUrl: "https://msumb.github.io/Clue-Solver/icon.png",
          permissions: ["pixel","overlay","gamestate"],
          defaultWindow: { title: "RS3 Compass Solver", width: 980, height: 640, resizable: true }
        };
        alt1.identifyApp(JSON.stringify(cfg));
      } catch (e) {
        alert("identifyApp failed: " + e.message);
      }
    } else {
      // Triggers Alt1 from a normal browser if protocol is registered
      location.href = "alt1://addapp/" + encodeURIComponent(CONFIG_URL);
    }
  };
</script>
</body>
</html>
