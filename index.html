<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RS3 Elite Clue Solver (Alt1)</title>
  <script src="https://alt1lib.com/lib/alt1lib.js"></script>
  <style>
    :root { --bg:#0b0f14; --panel:#0e141b; --edge:#1f2a36; --muted:#9fb0c0; --ink:#e6eef4; --accent:#58a6ff; --good:#22c55e; --warn:#f59e0b; --bad:#ef4444; }
    html,body{height:100%;margin:0;background:var(--bg);color:var(--ink);font:14px/1.45 system-ui,Segoe UI,Roboto,Arial}
    .wrap{display:grid;grid-template-columns:1fr;grid-template-rows:auto 1fr; height:100%}
    header{padding:10px 12px;border-bottom:1px solid var(--edge);background:var(--panel);display:flex;align-items:center;gap:12px}
    h1{font-size:16px;margin:0;color:var(--accent)}
    .spacer{flex:1}
    .btn{background:#0c1622;color:var(--ink);border:1px solid #203042;border-radius:8px;padding:8px 12px;cursor:pointer}
    .btn:hover{border-color:#34577b}
    #map{display:block;width:100%;height:calc(100vh - 48px);background:#07101b}
    .hud{position:absolute;left:10px;top:10px;background:rgba(0,0,0,.55);backdrop-filter:blur(4px); border:1px solid rgba(255,255,255,.18);border-radius:10px;padding:8px 8px; z-index:5}
    .hud .row{display:flex;gap:8px;align-items:center;margin:4px 0}
    .hud .coords{font-variant-numeric:tabular-nums;font-size:12px;color:#d9e7f5}
    .hud label{display:flex;align-items:center;gap:6px;font-size:12px;color:var(--muted)}
    .toast{position:absolute;left:50%;transform:translateX(-50%);bottom:10px;background:#0c1622;border:1px solid #203042;color:#cfe2f5;padding:8px 10px;border-radius:10px}
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.65);display:none;align-items:center;justify-content:center;z-index:20}
    .modal .card{background:#0c1622;border:1px solid #203042;border-radius:12px;max-width:90vw;max-height:90vh;padding:10px}
    .modal h3{margin:4px 0 10px;font-size:15px}
    .capwrap{position:relative}
    .capwrap canvas{max-width:80vw;max-height:70vh}
    .selbox{position:absolute;border:2px dashed #58a6ff;pointer-events:none}
    .small{font-size:12px;color:#9fb0c0}
    .chip{display:inline-block;padding:3px 8px;border-radius:999px;border:1px solid #22415f;background:#0c1622;color:#b9cce0;font-size:12px;margin-right:6px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>RS3 Elite Clue Solver (Compass)</h1>
      <span id="a1state" class="small">Detecting Alt1…</span>
      <span class="spacer"></span>
      <button id="btnInstall" class="btn">Install in Alt1</button>
    </header>

    <div style="position:relative">
      <canvas id="map"></canvas>

      <!-- Floating HUD -->
      <div class="hud">
        <div class="coords" id="coord">--.-- South, --.-- East</div>
        <div class="row">
          <button id="btnClear" class="btn">Clear markers</button>
          <button id="btnUndo" class="btn">Undo last</button>
          <button id="btnImportPins" class="btn">Import locations JSON</button>
        </div>
        <div class="row">
          <button id="btnWatch" class="btn">Start compass watch</button>
          <button id="btnSetBox" class="btn">Set compass box</button>
          <span class="chip">Angle: <span id="angle">--</span>°</span>
        </div>
        <div class="row">
          <label><input type="checkbox" id="chkPins" checked> Show known locations</label>
          <label><input type="checkbox" id="chkArc"> The Arc</label>
        </div>
        <div class="row small">Tip: Teleport, click your exact tile on the map → a ray is placed using the live compass angle. Two+ rays will triangulate.</div>
      </div>

      <div class="toast" id="toast" style="display:none"></div>
    </div>
  </div>

  <!-- Modal: set compass capture box -->
  <div id="modal" class="modal">
    <div class="card">
      <h3>Set compass capture box</h3>
      <div class="capwrap">
        <canvas id="cap"></canvas>
        <div id="sel" class="selbox"></div>
      </div>
      <div class="small" style="margin-top:8px">Drag to draw a rectangle around the <b>compass widget</b> near the minimap, then press Enter. Esc to cancel.</div>
    </div>
  </div>

  <input id="filePins" type="file" accept="application/json" style="display:none" />

  <script>
    // --- trimmed JS: full code from conversation here ---
  </script>
</body>
</html>
